experiment:
  name: baseline
  seed: 42

data:
  nih_root: "datasets/NIH Chest X-Rays Master Datasets/archive"
  chexpert_root: "datasets/Standford ML Group X-Rays Chest Master Datasets/cheXphoto-master/cheXphoto-master"
  csv_path: "datasets/NIH Chest X-Rays Master Datasets/archive/Data_Entry_2017.csv"
  image_size: [320, 320]  # High-resolution input to preserve spatial fidelity of small nodules
  num_workers: 4  # Increase for faster data loading (adjust based on CPU cores)
  train_split: 0.8
  val_split: 0.1
  test_split: 0.1
  patient_split: true  # Patient-level splitting to prevent data leakage
  use_roi_extraction: true  # Extract lung ROI to remove artifacts and prevent shortcut learning

augmentations:
  horizontal_flip_prob: 0.5
  rotation_degrees: 10.0  # Limited to ±10° for anatomical plausibility (per thesis)
  random_noise_std: 0.01
  use_gan_synthetic: false
  # Random Resized Crop (scale 0.8-1.0) is applied automatically in dataset

training:
  batch_size: 16  # Reduced for 320x320 resolution
  max_epochs: 60
  precision: "16-mixed"  # Use mixed precision on GPU (faster, same accuracy), falls back to 32 on CPU
  accumulate_grad_batches: 4  # Recommended for 320x320 on 4GB VRAM
  optimizer: adamw
  learning_rate: 0.0001  # Lower rate for fine-tuning textures in high-resolution medical images
  weight_decay: 0.01
  scheduler: cosine
  warmup_epochs: 5  # Gradually increase LR to stabilize DenseNet-121 backbone
  use_weighted_sampling: false  # ASL handles imbalance, sampling not needed

model:
  backbone: densenet121
  pretrained: true
  dropout: 0.2
  num_classes: 2
  class_weights: [1.0, 3.0]  # Boost for Fibrosis (prevalence <1.5%) to exit trivial solution trap

loss:
  name: asymmetric  # Asymmetric Loss (ASL) for extreme class imbalance
  gamma_neg: 4.0  # Focusing parameter for negative samples
  gamma_pos: 1.0  # Focusing parameter for positive samples
  clip: 0.05  # Reduced from 0.2 to allow signal from easy negatives early on

